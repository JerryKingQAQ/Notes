# 计算机网络-复习

| 协议                     | 描述                                                         | 备注                                           |
| ------------------------ | ------------------------------------------------------------ | ---------------------------------------------- |
|                          |                                                              |                                                |
| 码分复用CDM              | 码分复用是一种共享信道的方法。当码分复用信道为多个不同地址的用户所共享时，就称为**码分多址CDMA** | 属于**物理层**                                 |
|                          |                                                              |                                                |
| 帧检验序列 **FCS**       | 在**数据后面添加上的冗余码**称为**帧检验序列 FCS** (Frame Check Sequence)。 | 属于**数据链路层**<br />                       |
| **CRC**差错检验          | 在数据链路层传送的帧中，广泛使用了**循环冗余检验 CRC** 的检错技术 |                                                |
| 点对点协议**PPP**        | 数据链路层中将一个将IP数据封装到串行链路的方法               | 组成：链路控制协议**LCP**、网络控制协议**NCP** |
| **CSMA/CD**协议          | 多个设备尝试同时访问共享传输媒体时，避免碰撞（collision）并有效地共享带宽 | 组成：逻辑链路控制**LLC**、媒体接入控制**MAC** |
|                          |                                                              |                                                |
| **ARP**协议              | 由IP地址解析出MAC地址                                        | 属于**网络层**                                 |
| 网络控制报文协议**ICMP** | 用于主机或路由器报告差错情况和提供有关异常情况的报告         | 应用：PING和tracert<br />**网络层协议**        |
| **IGP**和**EGP**         | 互联网两大路由选择协议，内部网关协议 IGP与外部网关协议 EGP   |                                                |
| 路由信息协议**RIP**      | 基于距离向量的路由选择协议                                   | 属于IGP协议                                    |
| 开放最短路径优先**OSPF** | 基于最短路径优先算法的路由许纳泽协议                         | 属于IGP协议                                    |
| 外部网关协议**BGP**      | 在AS之间交换”可达性“信息                                     | 属于EGP协议                                    |
| 网络组管理协议**IGMP**   | 让连接在本地局域网上的**多播路由器知道**本局域网上是否有主机参加或退出了某个多播组 |                                                |
| 虚拟专用网**VPN**        | 利用公用的互联网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网 |                                                |
| 网络地址转换 **NAT**     | 多个主机使用同一IP地址，利用端口号区分主机的协议叫做**NAPT** |                                                |
|                          |                                                              |                                                |
| **TCP**协议              | 一种面向连接的协议、可靠                                     | 属于**运输层**                                 |
| **UDP**协议              | 一种无连接协议、不可靠                                       | 应用：DNS、DHCP、SNMP                          |
| 自动重传请求**ARQ**      | 通常 A 最终总是可以收到对所有发出的分组的确认。使用上述的确认和重传机制，我们就可以在不可靠的传输网络上**实现可靠**的通信。 |                                                |



<div style="page-break-after:always"></div>

## 第一章 概述

### 1.电路交换、报文交换、分组交换技术的特点、区别



| 类型     | 特点                                                         | 区别                 |
| -------- | ------------------------------------------------------------ | -------------------- |
| 电路交换 | 在通信过程中，建立了一条持续的连接（电路）用于数据传输。连接建立后，通信的两个节点之间的传输路径被独占，不被其他用户占用 | 连接是一直保持       |
| 报文交换 | 整个报文先传送到相邻节点，全部存储下来后查找转发表，转发到下一个节点 | 传递的是整一个报文   |
| 分组交换 | 单个分组（这只是整个报文的一部分）传送到相邻节点，存储下来后查找转发表，转发到下一个节点 | 将一个报文分成很多组 |

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624193441441.png" alt="image-20230624193441441" style="zoom:40%;" />



### 2.网络协议的概念、协议三要素

网络协议 (network protocol)，简称为协议， 是为进行网络中的数据交换而建立的规则、标准或约定

协议三要素：

- **语法：**数据与控制信息的结构或格式
- **语义：**需要发出何种控制信息，完成何种动作以及做出何种响应
- **同步（时序）：**事件实现顺序的详细说明



### 3.C/S 方式与 P2P 方式的特点

C/S方式：客户−服务器方式

- 客户—服务器方式所描述的是进程之间**服务**和**被服务**的关系
- 客户是服务的请求方，服务器是服务的提供方
- 客户与服务器的通信关系建立后，**通信可以是双向的**，客户和服务器都可发送和接收数据

P2P 方式：对等方式

- 两 个主机在通信时并**不区分**哪一个是服务请求方还是服务提供方
- **每一个主机既是客户又是服务器**



### 4.每层的协议数据单元

PDU (Protocol Data Unit)：协议数据单元

OSI参考模型把**对等层次之间传送的数据单位**称为该层的协议数据单元 PDU。

- 物理层——比特流
- 数据链路层——帧
- 网络层——分组（IP数据报）（数据包）
- 运输层——运输层报文(TCP **TCP报文段**或**segment**（段）、UDP **UDP报文**或**用户数据报**)
- 应用层——应用层PDU（信息）



### 5.五层协议的网络体系结构的要点，包括各层的主要功能

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624195517974.png" alt="image-20230624195517974" style="zoom:50%;" />

主要功能：

- **物理层**
  - 物理层的任务就是**透明地传输比特流**。“透明地传送比特流”指实际电路传送后比特 流没有发生变化。
- **数据链路层**
  - 数据链路层的任务是将在网络层交下来的数据报**组装成帧**，在两个相邻结点间的链路 上实现帧的**无差错传输**
- **网络层**
  - 网络层负责为分组选择合适的路由，使源主机运输层所传下来的分组能够交付到目的主机
- **运输层**
  - 任务是**负责主机中两个进程间的通信**。因特网的运输层可使用两种不同的协议。即面 向连接的传输控制协议TCP 和无连接的用户数据报协议UDP。  
  - 面向连接的服务能够提供可靠的交付；无连接服务则不能提供可靠的交付。
- **应用层**
  - 应用层**确定进程之间通信的性质以满足用户的需要**。应用层不仅要提供应用进程所需 要的信息交换和远地操作，而且还要作为互相作用的应用进程的用户代理，来完成一些为 进行语义上有意义的信息交换所必须的功能。 

### 6.OSI/RM 体系结构

开放系统互连基本参考模型 OSI/RM，一个试图使各种计算机在世界范围内互连成网的标准框架

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624200308673.png" alt="image-20230624200308673" style="zoom:40%;" />

注意：TCP/IP体系结构只有四层

OSI 的七层协议体系结构的概念清楚，理论也较完整，但它**既复杂又不实用**



<div style="page-break-after:always"></div>

## 第二章 物理层

中继器工作在物理层

### 1.常用的编码方式及特点

| 编码方法         | 表示方法                                                 | 特点             |
| ---------------- | -------------------------------------------------------- | ---------------- |
| 不归零制         | 正电平代表1，负电平代表0                                 |                  |
| 归零制           | 正脉冲代表1，负脉冲代表0                                 |                  |
| ⭐曼彻斯特编码    | 位周期中心，低—>高代表0，高—>低代表1。但也可以反过来定义 | 具有自同步的能力 |
| 差分曼彻斯特编码 | 位开始**边界**有跳代表0，无跳代表1                       | 具有自同步的能力 |



### 2.波特率和比特率相关计算

码元：在数字通信中常常用时间间隔相同的符号来表示一个二进制数字,这样的时间间隔内的信号称为(二进制)码元

#### 奈氏准则

定义：在带宽为`W(Hz)`的低通信道中，若不考虑噪声影响，则码元传输的最高速率为``2W(码元/s)|(波特)`
$$
理想低通信道的最高码元传输速率 = 2W Baud
$$
**比特率和波特率的关系：**

- 比特率是指单位时间内所传输的**二进制代码**的有效位数，单位是**比特/秒(bps)**。
- 波特率是指每秒**传送的波形**的个数，单位是**波特(baud)**。
- 比特率和波特率之间的换算关系如下：`比特率 = 波特率×log2N`，其中**N为码元所表示的有效状态数**



#### 信噪比 香农公式

信噪比就是信号的**平均功率**和**噪声功率**之比
$$
信噪比(dB)=10log_{10}(S/N)\;(dB)
$$
上式为分贝表示法

香农公式指出：**信道的极限信息传输速率C为**
$$
C=Wlog_{2}(1+S/N)\;(bit/s)
$$
**其中W为信道的带宽（频率范围区间，以Hz为单位），此处S/N是信噪比的比值表示法**

例题：

假定要用**3kHz**带宽的电话信道传送**64kb/s**的数据（无差错传输），试问这个信道应该具有多高的信噪比（分别用比值和分贝来表示）

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624155852056.png" alt="image-20230624155852056" style="zoom:50%;" />





### 3.信道复用技术

包括频分复用、时分复用、统计时分复用、波分复用、码分复用（CDMA）

复用允许用户使用一个**共享**信道进行通信，**降低成本，提高利用率**



#### 频分复用FDM

- 将整个带宽分为多份，用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。
- 频分复用的所有用户在**同样的时间占用不同的带宽资源**（请注意，这里的“带宽”是频率带宽而不是数据的发送速率）

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624163215641.png" alt="image-20230624163215641" style="zoom:40%;" />



#### 时分复用TDM

- 时分复用则是将时间划分为一段段等长的**时分复用帧（TDM 帧）**。每一个时分复用的用户在每一个 TDM帧中**占用固定序号**的时隙。
- 每一个用户所占用的时隙是周期性地出现（其周期就是 TDM 帧的长度）
- 时分复用的所有用户是**在不同的时间占用同样的频带宽度**。

使用时分复用系统传送计算机数据时，由于**计算机数据的突发性质**，用户对分配到的子信道的利用率一般是不高的

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624163227486.png" alt="image-20230624163227486" style="zoom:40%;" />



#### 统计时分复用STDM

STDM 帧不是固定分配时隙，而是**按需动态地分配时隙**。因此统计时分复用**可以提高线路的利用率**。

- 在每个时隙中**需要有用户的地址信息**。
- 集中器**能正常工作的前提是假定各用户都是间歇地工作**

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624163627627.png" alt="image-20230624163627627" style="zoom:40%;" />



#### 波分复用WDM

就是**光的频分复用**，使用一根光纤来同时传输多个光载波信号



### 4.CDMA技术

码分复用CDM。码分复用是一种**共享信道**的方法。当码分复用信道为多个不同地址的用户所共享时，就称为**码分多址CDMA**

- 各用户使用经过特殊挑选的**不同码型**，因此彼此不会造成干扰
- 这种系统发送的信号**有很强的抗干扰能力**，其频谱类似于白噪声，不易被敌人发现



#### 码片序列

每一个比特时间划分为 m 个短的间隔，称为**码片**

将**码片中的0记为-1**，将**码片中的1记为+1**

每个站被指派一个唯一的 **m bit 码片序列：**

- 如发送比特 1，则发送自己的 m bit 码片序列
- 如发送比特 0，则发送该码片序列的二进制反码

例如：S 站的 8 bit 码片序列是 00011011

- 发送比特 1 时，就发送序列 00011011
- 发送比特 0 时，就发送序列 11100100
- **故S站的码片序列：（-1，-1，-1，+1，+1，-1，+1，+1）**



#### CDMA的重要特点

每个站分配的码片序列不仅**必须各不相同**，并且还必须**互相正交**，即S和T的规格化内积等于0
$$
S\cdot T\equiv \frac{1}{m} \displaystyle\sum_{i=1}^{m}{S_iT_i}=0
$$
对应位置相乘后相加，**最后除以m**（一定要注意求平均）

- 任何一个码片向量和**该码片向量自己**的规格化内积都是 **1**
- 一个码片向量和该码片**反码**的向量的规格化内积值是 **–1**

当**S站发送比特1（码片序列）时，在X站计算内积的结果是+1**；当**S站发送比特0（码片序列的反码）时，内积的结果是-1**。

**所有站收到的都是叠加的信号**。

当接收S站发送的信号时，就用**S站的码片序列与收到的信号求规格化内积**。S·S~x~就是S站发送的数据比特,因为在计算规格化内积时,或者都是+1,或者都是-1

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230624170943292.png" alt="image-20230624170943292" style="zoom:33%;" />





<div style="page-break-after:always"></div>

## 第三层 数据链路层

三个基本问题：**封装成帧、透明传输、差错检测**

### 1.CRC差错检验的计算

在数据链路层传送的帧中，广泛使用了**循环冗余检验 CRC** 的检错技术

在发送端，先把数据划分为组。假定每组 k 个比特。假设待传送的一组数据 M = 101001（现在 k = 6）。我们在 M 的后面再添加供差错检测用的 **n 位冗余码**一起发送

在**数据后面添加上的冗余码**称为**帧检验序列 FCS** (Frame Check Sequence)。

循环冗余检验 CRC 和帧检验序列 FCS 并不等同。

- CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419195625607.png" alt="image-20230419195625607" style="zoom:40%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419195745546.png" alt="image-20230419195745546" style="zoom:40%;" />



<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419195820598.png" alt="image-20230419195820598" style="zoom:40%;" />

**模二除法：**

- **同为0，异为1**
- 被除数位数不够，商为0；位数够，商为1
- 每次除法运算时最高位消除



#### 除数P的表示

一种较为方便的方法是用生成多项式来表示除数P
$$
P(x)=X^3+X^2+1
$$
上述多项式的**系数**为1101，故除数P=1101



#### CRC校验方式

把接收到的每一帧都**除以同样的除数P**，然后检查得到余数R'。

- 若R'=0，则判定这个帧没有差错，就接受
- 若R'≠0，则判定这个帧有差错，就丢弃
- 但是这种方式并不能确定究竟时哪一个或哪几个比特出现了差错

仅用循环冗余检验 CRC 差错检测技术只能做到**无差错接受 (accept)**



### 2.CSMA/CD协议的概念、作用和工作原理

中文名：**带冲突检测的载波侦听多路访问协议**

CSMA/CD含义：**载波监听多点接入 / 碰撞检测**

- **多点接入：**许多计算机以多点接入的方式连接在一根总线上
- **载波监听：**不管在想要发送数据之前，还是在发送数据之中，每个站都必须不停地检测信道**（先听后发、边听边发）**
- **碰撞检测：**计算机边发送数据边检测信道上的信号电压大小。当两个站同时发送数据时，总线上地信号电压变化就会大幅增加

作用：多个设备尝试同时访问共享传输媒体时，避免碰撞（collision）并有效地共享带宽

使用CSMA/CD协议地以太网只能进行双向交替通信（**半双工通信**）

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419211054758.png" alt="image-20230419211054758" style="zoom:40%;" />

**电磁波在1km电缆传播时延约为5μs**

发送端**至多**经过2τ就可以知道所发送数据是否遭受碰撞，以太网的端到端往返时延**2τ**称为争用期，或碰撞窗口。

#### 退避算法

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419211736445.png" alt="image-20230419211736445" style="zoom:40%;" />

基本避退时间为争用期2τ，具体地争用期时间为**51.2μs**。对于**10Mbits/s**以太网可以在争用期内发送**512比特**（64字节），也可以说争用期是**512比特时间**

这意味着： 以太网在发送数据时，**若前 64 字节没有发生冲突，则后续的数据就不会发生冲突**

**最短有效帧长：**

- **如果发生冲突，就一定是在发送的前 64 字节之内。**
- 由于一**检测到冲突就立即中止发送**，这时已经发送出去的数据一定小于 64 字节。
- 以太网规定了最短有效帧长为 64 字节，**凡长度小于 64 字节的帧**都是由于冲突而异常中止的**无效帧**



### 3.以太网帧的尺寸

典型的以太网帧格式如下：

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230418201716038.png" alt="image-20230418201716038" style="zoom:35%;" />

**MAC帧格式：**

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419214554880.png" alt="image-20230419214554880" style="zoom:40%;" />

MAC帧首部尾部长度共有18字节。**有效MAC帧长度为64~1518字节之间**

无效的MAC帧：

- 帧长度不是整数个字节
- 用收到的帧检验序列FCS查出有差错
- 收到的帧的MAC客户**数据字段**的长度**不在46\~1500字节之间**



### 4.集线器与交换机的特点、区别

集线器：

- 集线器很像一个**多接口的转发器**，工作在**物理层**
- 采用广播的方式
- 使用集线器的以太网在逻辑上仍是一个总线网， 各工作站使用的还是 **CSMA/CD 协议**，并共享逻辑上的总线

交换机：

- 交换机工作在**数据链路层**
- 根据数据包中的MAC地址转发数据
- 以太网交换机是一种即插即用设备，其内部的**帧交换表（又称为地址表）是通过自学习算法自动地逐渐建立起来的**



集线器的特点：

1. 物理层设备：集线器工作在**物理层**，主要负责物理信号的传输和信号的放大。
2. 广播传输：当集线器接收到一个数据包时，它会将数据包复制并广播到所有连接的端口上，无论数据包的目标地址是哪个设备。因此，集线器工作在广播域。
3. 共享带宽：集线器的所有端口共享同一带宽，即当多个设备同时传输数据时，会发生碰撞，造成网络性能下降。
4. 无智能性：集线器没有智能的转发能力，无法根据MAC地址进行数据包的选择性转发。

交换机的特点：

1. 数据链路层设备：交换机工作在**数据链路层**，能够解析数据包的MAC地址，并基于MAC地址进行数据包的转发。
2. 独立转发：交换机会根据数据包的目标MAC地址，选择性地将数据包只发送到目标设备所连接的端口，从而避免了广播和碰撞。
3. 增强的带宽利用：由于交换机具有独立转发能力，它可以同时在不同端口之间进行并行转发，提供更高的带宽利用率。
4. 自学习能力：交换机能够学习和记忆设备的MAC地址，并将这些信息存储在一个转发表中，以便后续的数据转发。

区别总结：

1. 功能层次：集线器工作在物理层，而交换机工作在数据链路层。
2. 转发方式：集线器进行广播传输，交换机进行选择性转发。
3. 带宽利用：集线器的带宽是共享的，交换机能够提供更高的带宽利用率。
4. 智能性：集线器没有智能的转发能力，交换机具有自学习和转发表的能力。

注意：集线器和交换机都被认为在同一广播域下。**交换机能划分冲突域**

**第三层的路由器划分广播域**



### 5.交换机的工作原理

首先地址表是空的

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419215136315.png" alt="image-20230419215136315" style="zoom:40%;" />

假设A向B发送一帧，从E0端口进入。交换机接收到帧后，先检查交换表中有没有B的地址。

现在没有B的地址，**首先将自己A的地址与端口写入交换表，并向除这个端口以外的所有端口广播这个帧**。广播可以使得B一定收到这个帧，而C、D因为目的地址不匹配和丢弃此帧**（过滤）**。

B要给A发送一帧，**因为交换表已经有了地址，所以直接转发，同时将自己的地址与端口写入**。

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419215154274.png" alt="image-20230419215154274" style="zoom:40%;" />



### 6.星型以太网10BASE-T的含义

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419213036006.png" alt="image-20230419213036006" style="zoom:40%;" />

BASE：基带信号传输方式



### 7.VLAN技术的概念和作用

蠕虫病毒相当泛滥，一旦病毒发起泛洪广播攻击， 将会很快占用完网络的带宽，导致网络的阻塞和瘫痪。

虚拟局域网（ VLAN ）：它是将局域网从逻辑上**划分为一个个的网段**，从而实现虚拟工作组的一种交换技术

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419215647156.png" alt="image-20230419215647156" style="zoom:40%;" />

不同交换机连接的设备可以划分到同一虚拟局域网中。



### 8.生成树协议的作用

背景：

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230419215500970.png" alt="image-20230419215500970" style="zoom:40%;" />

**生成树协议STP：**

不改变网络的实际拓扑，但在**逻辑上则切断某些链路**，使得从一台主机到所有其他主机的**路径是无环路的树状结构**，从而消除了兜圈子现象。



<div style="page-break-after:always"></div>

## 第四章 网络层

### 1.虚电路和数据报服务的区别

| 服务                         | 优点                                                         | 缺点                                                         |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 面向连接，建立一条**虚电路** | 传输质量高；传输的数据总是按顺序抵达                         | 花销大；必须要建立连接；一旦出现故障结点整条虚电路就无法运作 |
| 无连接，**数据报服务**       | 简单灵活、花销小；不需要建立连接；即使出现部分结点故障依然可以保证传输 | 不提供服务质量的承诺；传输的数据不按照顺序抵达               |



### 2.常见的网络互联设备工作在哪层？

不同层的中继系统：

- **物理层**中继系统：**转发器**、**中继器、集线器**
- **数据链路层**中继系统：**网桥or桥接器**、**交换机**
- **网络层**中继系统：**路由器**
- **网络层以上**的中继系统：**网关**
- 网桥和路由器的混合物  ——>  桥路器



### 3.IP地址和硬件地址的区别

**IP地址**就是给每个连接在互联网上的主机分配一个全世界范围内**唯一**的32位的标识符

从层次的角度：

- **硬件地址**（MAC地址）是**数据链路层与物理层使用**的地址
- **IP地址**是网络层和以上各层使用的地址，是**一种逻辑地址**



### 4.ARP协议的作用、工作原理

地址解析协议  ARP

**作用：从网络层使用的IP地址，解析出在数据链路层使用的硬件地址**

#### 工作原理

当主机A欲向本局域网的某个主机B发送IP数据报时，就先在其**ARP高速缓存**中查看有无B的IP地址：

- 如果有，就可以查出对应的硬件地址，**再将此硬件地址写入MAC帧**，然后通过局域网将该MAC帧发往此硬件地址
- 如没有，ARP进程在本局域网上广播发送一个**ARP请求分组**（顺带把自己的地址也写入其中）。收到**ARP响应分组**后，将得到的IP地址到硬件地址的映射写入ARP高速缓存

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230519211508494.png" alt="image-20230519211508494" style="zoom: 40%;" />

当目的主机和源主机**不在同一个局域网**时，通过ARP找到**默认网关**的硬件地址，然后由默认 网关把分组转发给下一个网络



### 5.子网划分、CIDR相关计算

#### 子网划分

从 1985 年起在 IP 地址中又增加了一个“子网号字段”，使得二级IP地址到三级IP地址，这种做法叫做**划分子网**

划分子网纯属一个**单位内部的事情**。单位对外仍然表现为没有划分子网的网络。**从主机号借用若干个位作为子网号** subnet-id，而主机号 host-id 也就相应减少了若干个位

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230520204400960.png" alt="image-20230520204400960" style="zoom:40%;" />

主要流程：

- 凡是从**其他网络**发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的**目的网络号 net-id**，先找到连接在本单位网络上的路由器
- 然后**此路由器**在收到 IP 数据报后，再按**目的网络号** net-id 和**子网号** subnet-id 找到目的子网
- 最后就将 IP 数据报直接交付目的主机



##### 子网掩码

**(IP地址) AND (子网掩码) = 网络地址** (均为1时才为1)

子网掩码的表示：

- 使用十进制数表示：255.255.255.0
- 使用“/网络位数”表示，如13.129.6.1/**8** -> 13.129.6.1 255.0.0.0



#### 无分类编址 CIDR

**CIDR 消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念**，使用各种长度的“网络前缀”(network-prefix)来代替分类地址中的网络号和子网号

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230520220329586.png" alt="image-20230520220329586" style="zoom:40%;" />

CIDR 把网络前缀都相同的连续的 IP 地址组成**“CIDR 地址块“**

128.14.32.0/20 表示的地址块共有 2^12^个地址（因为斜线后面的 **20 是网络前缀的位数**，所以这个地址的**主机号是 12 位**）

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230520220517239.png" alt="image-20230520220517239" style="zoom:33%;" />



| CIDR前缀长度 | 点分十进制        | 包含的地址数 | 相当于包含分类的网络数 |
| ------------ | ----------------- | ------------ | ---------------------- |
| **/16**      | **255.255.0.0**   | **64K**      | **1个B类或256个C类**   |
| /20          | 255.255.240.0     | 4K           | 16个C类                |
| **/24**      | **255.255.255.0** | **256**      | **1个C类**             |



### 6.路由转发分组的算法

在**划分子网情况下**路由器转发分组的算法：

1. 从收到的分组的首部提取目的 IP 地址 D
2. (发送端)先用各网络的**子网掩码和 D 逐位相“与”**(AND)，看是否和相应的网络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，执行(3)
3. 若路由表中有目的地址为 D 的**特定主机路由**，则将分组传送给指明的下一跳路由器；否则，执行 (4)。
4. **对路由表中的每一行，将子网掩码和 D 逐位相“与”**(AND)(直接由2.结果可得)。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行(5)
5. 若路由表中有一个**默认路由**，则将分组传送给路由表中所指明的默认路由器；否则，执行 (6)
6. 报告转发分组出错

**用路由表条目中各网络的子网掩码和目的 IP 地址逐位相“与”**，判断是否和相应的网络地址匹配。



### 7.理解最长匹配原则

使用 CIDR 时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成。在查找路由表时可能会得到**不止一个匹配结果**。

应当从匹配结果中选择具有最长网络前缀的路由：**最长前缀匹配**

**举例：**

收到的分组的目的地址D=206.0.71.130

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230520222134867.png" alt="image-20230520222134867" style="zoom: 40%;" />



### 8.路由选择协议

互联网两大类路由选择协议：

- 内部网关协议 IGP （Interior Gateway Protocol）
  - 自治系统之内的协议
  - 在一个自治系统**内部使用**的路由选择协议
  - 使用量最多，例如**RIP和OSPF**
- 外部网关协议 EGP （External Gateway Protocol）
  - 自治系统之间的协议
  - 在自治系统边界时，将路由选择信息传递到另一个自治系统中
  - 使用最多的是**BGP-4**协议

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230522201517741.png" alt="image-20230522201517741" style="zoom:40%;" />



### 9.RIP、OSPF协议的特点

#### RIP协议

路由信息协议 RIP (Routing Information  Protocol) 是内部网关协议 IGP 中最先得到广泛使用的协议

- RIP 是一种**分布式的、基于距离向量的路由选择协议**
- RIP 协议要求网络中的每一个路由器都要**维护**从它自己到其他每一个目的网络的**距离记录**

**“距离“的定义：**

- 从一个路由器到**直接连接**的网络的距离定义为1
- 从一个路由器到非直接连接的网络的**距离**定义为**所经过的路由器数加 1**
- RIP协议中的距离也被称为”跳数“
- **RIP 允许一条路径最多只能包含 15 个路由**
- **“距离”的最大值为 16 时即相当于不可达**
- **RIP 不能在两个网络之间同时使用多条路由**，RIP选择一个具有最少路由器的路由，哪怕还存在另一个高速（低时延）但路由器较多的路由



**RIP协议的特点：**

- 仅和**相邻路由器**交换信息
- 交换的信息时当前本路由器知道的**全部信息，即自己的路由表**
- 按**固定的时间间隔**交换路由信息。即使网络拓扑发生变化时，路由器也能及时向相邻路由器通告拓扑变化后的路由信息
- **好消息传播得快，坏消息传播得慢**
- RIP能使用的最大距离为15跳，适用于小型网络

RIP存在的一个问题：当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器



##### **距离向量算法**

1. 路由器收到相邻路由器（**其地址为X**）的一个RIP报文

2. 先修改此RIP报文中的所有项目：把”**下一跳“字段中的地址都改为X**，并把所有**”距离“字段的值都加1**

3. 若**目的网络不在路由表**中，则把该项目加到路由表中

   - 否则

     若**下一跳**字段给出的路由地址是**相同的**（例如路由表中也为X），则把收到的项目替换原路由表中的项目（**直接修改**）

   - 否则

     若收到**项目的距离小于路由表中的距离**（下一跳不相同），则进行更新（下一跳地址也会更新）

   - 否则

     什么也不做

4. ) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为 16（表示不可达）

5. 返回

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230623222027776.png" alt="image-20230623222027776" style="zoom:40%;" />



#### OSPF协议

**开放最短路径优先** OSPF (Open Shortest Path First)是为克服 RIP 的缺点在1989年开发出来的

OSPF协议基本特点：

- ”最短路径优先“是因为使用了Dijkstra提出的最短路径算法 ，默认情况下使用100Mbps带宽计算OSPF成本
- OSPF 通过**洪泛**发送更新分组
- **OSPF 不用 UDP 而是直接用 IP 数据报传送**
- **OSPF 的更新过程收敛得快是其重要优点**
- 如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径。这叫作**多路径间的负载平衡**
- **支持可变长度的子网划分和无分类编址 CIDR**
- **OSPF 没有“坏消息传播得慢”的问题**，因为一个路由器的链路状态只涉及到与相邻路由器的连通状态，与整个互联网的规模并无直接关系。因此当**互联网规模很大时，OSPF  协议要比距离向量协议 RIP 好得多**
-  OSPF 将一个自治系统再划分为若干个更小的范围，叫作**区域**

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230522232128852.png" alt="image-20230522232128852" style="zoom:40%;" />



### 10.专用IP地址

![image-20230627223905497](C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230627223905497.png)





<div style="page-break-after:always"></div>

## 第五章 传输层

### 1.端口的作用

运输层是为应用进程之间提供端到端的逻辑通信，一个主机可能有多个应用进程同时分别和另一个主机中的多个应用进程通信。

使用**端口**来区分同一主机的不同应用程序，实现**复用和分用**功能

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230603195948711.png" alt="image-20230603195948711" style="zoom: 33%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230622213855127.png" alt="image-20230622213855127" style="zoom:50%;" />



### 2.TCP与UDP协议的特点、区别

**UDP：一种无连接协议**

- 提供无连接服务，**不提供可靠交付**
- 在传送数据之前**不需要先建立连接**
- 传送的数据单位协议是 **UDP 报文或**用户数据报
- 对方的运输层在收到 UDP 报文后，**不需要给出任何确认**
- **首部字段只有8字节**
- 接上首部后直接插入IP数据报部分



**TCP：一种面向连接的协议**

- 提供可靠的、面向连接的服务
- 传送的数据单位协议是 **TCP 报文段** (segment)
- **TCP 不提供广播或多播服务**
- 开销大、占用的处理器资源多
- **首部字头有20字节固定首部**



**检验和字段：**

- 校验和算法一样，但作用范围不同
- IP校验和只校验**IP数据报的首部**
- ICMP校验和覆盖整个**ICMP报文（首部+数据）**
- UDP和TCP校验和不仅**覆盖整个报文**，而且还有12字节的**伪首部**



### 3.TCP报文段序号、确认号、窗口等字段的含义

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230606200637235.png" alt="image-20230606200637235" style="zoom: 33%;" />

解释：

- 序号字段seq——占4字节。TCP连接中传送的数据流中的每一个字节都编上一个序号。**序号字段的值则指的是本报文段所发送的数据的第一个字节的序号**
- 确认号字段ack——占 4 字节，确认号字段的值**是期望收到对方的下一个报文段的数据的第一个字节的序号**（在这之前序号的数据已经收到）
- 窗口字段 —— 占 2 字节，窗口字段用来控制**对方发送的数据量**， **单位为字节**。**TCP 连接的一端根据设置的缓存空间大小确定自己的接收窗口大小**，然后通知对方以确定对方的发送窗口的上限
- 描述字段
  - 确认ACK，**只有当ACK=1时确认号字段才有效**
  - 复位RST，当 RST=1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因），**必须释放连接，然后再重新建立运输连接**
  - 终止 FIN，用来释放一个连接。FIN=1 表明此报文段的**发送端的数据已发送完毕**，并要求**释放运输连接**



### 4.滑动窗口机制-可靠传输

**TCP的滑动窗口是以字节为单位的**

滑动窗口传输过程：

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230606212154817.png" alt="image-20230606212154817" style="zoom:33%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608144944363.png" alt="image-20230608144944363" style="zoom:33%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608151810930.png" alt="image-20230608151810930" style="zoom:33%;" />



### 5.滑动窗口-流量控制

我们希望数据传输更快一点，但是太快会导致接收方来不及接收，导致数据的丢失

**流量控制：**就是让发送方的**发送速率不要太快**，既要让接收方来得及接收，也不要使网络发生拥塞

利用**可变窗口（rwnd）**进行流量控制举例

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608205825877.png" alt="image-20230608205825877" style="zoom: 50%;" />

rwnd报文丢失（一直为0窗口）导致的**死锁**问题：

- 如果发送**rwnd=400**的报文段出现了丢失，就会造成**死锁局面**
- 为解决这个问题，TCP为每一个连接设置一个**持续计时器**：
  - 只要 TCP 连接的一方收到对方的**零窗口**通知，就启动该持续计时器
  - 若持续计时器设置的**时间到期**，就发送一个**零窗口探测报文段**（仅携带 1 字节的数据），而对方就在确认这个探测报文段时给出了现在的窗口值
    - 若窗口仍然是零，则收到这个报文段的一方就重新设置持续计时器
    - 若窗口不是零，则死锁的僵局就可以打破了



### 6.滑动窗口-拥塞控制

在某段时间，若对**网络中**某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种现象称为**拥塞 (congestion)**。

TCP 采用**基于窗口的方法**进行拥塞控制。该方法属于**闭环控制**（基于反馈的，**开环控制**是指在设计网络的时候就考虑周到）方法

TCP发送方维持一个**拥塞窗口CWND**：

- 窗口大小取决于网络拥塞程度
- 发送端利用拥塞窗口来调整发送的数据量



### 7.拥塞控制算法

**TCP拥塞控制算法：**

- 慢开始
- 拥塞避免
- 快重传
- 快恢复

#### ① 慢开始

**算法的思路：由小到大逐渐增大拥塞窗口数值**

初始设置：

- 设置**初始拥塞窗口cwnd**（单位为报文段）
- **慢开始门限ssthresh（状态变量）**
  - 防止拥塞窗口cwnd增长过快导致网络拥塞

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608215343359.png" alt="image-20230608215343359" style="zoom: 40%;" />

**慢开始门限 ssthresh** 的用法如下:

- cwnd＜ssthresh，使用慢开始算法
- cwnd＞ssthresh，停止使用慢开始算法而改用**拥塞避免算法**
- cwnd=ssthresh，都可以使用



#### ② 拥塞避免算法

**思路：让拥塞窗口 cwnd 缓慢地增大，即每次cwnd加1，按照线性规律缓慢增长**

当网络出现拥塞时，无论在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞**（重传定时器超时）**：

- `ssthresh=max(cwnd/2, 2)`（**此时cwnd是发生超时的时候的值**）
- `cwnd=1`
- 执行慢开始算法

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608220148756.png" alt="image-20230608220148756" style="zoom:40%;" />



#### ③ 快重传算法

采用快重传算法可以让发送方**尽早知道发生了个别报文段的丢失**

**快重传算法**首先要求接收方不要等待自己发送数据时才进行捎带确认，而是要**立即发送确认**， 即使收到了**失序的报文段**（中间的某个报文段丢失，后序报文段接收）也要立即发出对**已收到的报文段的重复确认**

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608220357456.png" alt="image-20230608220357456" style="zoom:40%;" />

**发送方只要一连收到三个重复确认**，就知道接收方确实没有收到报文段，因而应当**立即进行重传（即“快重传”）**，这样就不会出现超时， 发送方也不就会误认为出现了网络拥塞



#### ④ 快恢复算法

当发送端收到连续**三个重复的确认**时，由于发送方现在认为网络很可能**没有发生拥塞**，因此现在不执行慢开始算法，而是执行**快恢复算法** FR (Fast Recovery) 算法：

- **慢开始门限ssthresh=当前拥塞窗口cwnd/2**
- **新拥塞窗口cwnd=慢开始ssthresh**
- 开始执行拥塞避免算法

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608220624888.png" alt="image-20230608220624888" style="zoom:40%;" />



### 8.流量控制和拥塞控制的作用与区别

- 流量控制
  - **流量控制**往往指点对点通信量的控制，是个**端到端的问题**（接收端控制发送端）
  - 流量控制所要做的就是**抑制发送端发送数据的速率**，以便使接收端来得及接收
- 拥塞控制	
  - 拥塞控制就是**防止过多的数据注入到网络**中，使网络中的路由器或链路不致过载
  - 拥塞控制所要做的都有一个前提，就是网络能够承受现有的网络负荷
  - **拥塞控制**是一个**全局性**的过程，涉及所有的主机、路由器、降低网络传输性能有关的所有因素



### 9.TCP连接建立过程

TCP采用**三报文握手协议**建立连接（请想象两条数据流）

**SYN要设置为1**

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608221340516.png" alt="image-20230608221340516" style="zoom: 40%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608221348670.png" alt="image-20230608221348670" style="zoom:40%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608221428992.png" alt="image-20230608221428992" style="zoom:40%;" />

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608221452478.png" alt="image-20230608221452478" style="zoom:40%;" />

三次握手时的服务器状态：

<img src="C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230608223653907.png" alt="image-20230608223653907" style="zoom:40%;" />

<div style="page-break-after:always"></div>

## 第六章 应用层

### 6.1 域名系统DNS

管理域名的系统就是DNS。将主机**域名映射成IP地址**的过程称为**域名解析**

域名的IP地址的解析是由若干个域名服务器程序完成的。域名服务器程序在专设的节点上运行，运行该程序的机器称为**域名服务器**

主机把待解析的域名放在DNS请求报文中，以**UDP用户数据报**方式发给本地域名服务器（使用UDP是为了减少开销），**端口号是53**



域名服务器有以下四种类型：

- **根域名服务器**：根域名服务器是最高层次的域名服务器，也是最重要的域名服务器，**所有的根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址**
- 顶级域名服务器：顶级域名服务器负责**管理在该顶级域名服务器注册的所有二级域名**
- 权限域名服务器：**负责一个区**的域名服务器
- 本地域名服务器：**当一个主机发出 DNS 查询请求时，这个查询请求报文就发送给本地域名服务器**



#### DNS的作用

域名系统 DNS 是互联网使用的命名系统，**用来把便于人们使用的机器名字转换为IP地址**



#### DNS传输过程

**本地域名服务器**离用户较近，一般不超过几个路由器的距离。当一个主机发出 DNS 查询请求时，这个查询请求报文**就发送给本地域名服务器**。当所要查询的主机也属于同一个本地 ISP 时，该本地域名服务器立即就能将所查询的主机名转换为它的 IP 地址，而不需要再去询问其他的域名服务器

**根域名服务器是最高层次的域名服务器**，也是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址。根域名服务器是最重要的域名服务器，因为不管是哪一个本地域名服务器，若要对互联网上任何一个域名进行解析（即转换为 IP 地址），**只要自己无法解析，就首先要求助于根域名服务器。**

**顶级域名服务器**负责**管理在该顶级域名服务器注册的所有二级域名**。当收到DNS查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当找的域名服务器的IP地址）

一个服务器所负责管辖的（ 或有权限的）范围叫作区 。 各单位根据具体情况来划分自己管辖范围的 区。但在一个区中的所有节点必须是能够连通的。每一个区设置相应的权限域名服务器，**用来保存该区中的所有主机的域名到 IP 地址的映射**。因此，**权限域名服务器**是**负责一个区的域名服务器** 。当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的DNS客户，下一步应当找哪一个权限域名服务器

![image-20230615200550804](C:\Users\Jerry\AppData\Roaming\Typora\typora-user-images\image-20230615200550804.png)



### 6.2 文件传输协议FTP

文件传送协议FTP是互联网上使用得最广泛的文件传输协议

将文件从一台计算机中复制到另一台可能相距很远的计算机中

**文件传送协议 FTP使用 TCP 可靠的运输服务**

FTP 的主要功能是**减少或消除在不同操作系统下处理文件的不兼容性**

**控制连接**端口号**21**，**数据连接**端口号**20**



### 6.4 超文本传输协议HTTP

为了使**超文本的链接能高效地完成**，需要用HTTP协议来传送一切必须的信息

它使用了**面向连接的TCP向上提供的服务，端口是80** 



### 6.6 动态主机配置协议DHCP

互联网广泛使用的动态主机配置协议 DHCP提供了**即插即用**连网的机制，这种机制允许**一台计算机加入新的网络和获取 IP 地址而不用手工配置**

**可以动态为参数赋值**

**使用UDP传输，DHCP客户使用的端口是68，而服务器使用的端口是67**

DHCP 使用**客户服务器**方式，DHCP 客户在启 动时向 DHCP 服务器广播发现报文，DHCP 服 务器返回回答报文

当DHCP 客户与服务器不在同一网段时，需要 由**DHCP 中继代理**以**单播方式**转发发现报文

​																							————Jerry